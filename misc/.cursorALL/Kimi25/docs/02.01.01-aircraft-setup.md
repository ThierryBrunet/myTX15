# Aircraft Setup Guides

## 01.00.00 - Quadcopter Setup (Angel30)

### 01.01.00 - Hardware Configuration

**Frame**: Angel30 3-inch Carbon Fiber
**Flight Controller**: DarwinFPV F415 AIO (F4 + 4-in-1 ESC + ELRS)
**Receiver**: Integrated ELRS 2.4GHz
**Motors**: 1404 or similar 3-inch appropriate
**Props**: 3-inch triblade (e.g., Gemfan 3016)
**Battery**: 3S-4S 450-850mAh LiPo

### 01.02.00 - DarwinFPV F415 Configuration

#### 01.02.01 - Betaflight Setup

**CLI Commands**:
```
# Board alignment (check arrow direction)
set align_board_yaw = 0

# Serial ports
serial 0 64 115200 57600 0 115200  # ELRS on UART1

# Receiver
set serialrx_provider = CRSF
set serialrx_inverted = OFF

# Motor protocol
set motor_pwm_protocol = DSHOT300
set dshot_idle_value = 4.5

# Arming safety
set small_angle = 180
set auto_disarm_delay = 5
set disarm_kill_switch = ON

# Failsafe
set failsafe_delay = 5
set failsafe_off_delay = 0
set failsafe_throttle = 1000
set failsafe_switch_mode = STAGE1
set failsafe_procedure = DROP

# Modes (adjust ranges to match your radio)
aux 0 0 0 1700 2100 0 0   # ARM (CH5 high)
aux 1 1 1 1300 1700 0 0   # ANGLE (CH6 mid)
aux 2 2 1 1700 2100 0 0   # HORIZON (CH6 high)
aux 3 13 2 1700 2100 0 0  # BEEPER (CH7 high)
aux 4 35 3 1700 2100 0 0  # TURTLE MODE (CH8 high)

# Rates (for Indoor/Outdoor modes, radio will limit further)
set roll_rc_rate = 50
set pitch_rc_rate = 50
set yaw_rc_rate = 50
set roll_expo = 30
set pitch_expo = 30
set yaw_expo = 20

# Filters (3-inch quad)
set gyro_lowpass_hz = 250
set dterm_lowpass_hz = 100

save
```

#### 01.02.02 - ELRS Configuration (Integrated)

**Via ELRS Configurator**:
1. Select "DarwinFPV F4 2.4GHz" target
2. Packet Rate: 250Hz (balance of range/latency)
3. Telemetry Ratio: 1:64
4. Switch Mode: Hybrid
5. Flash via "Betaflight Passthrough"

**Binding**:
- Set binding phrase in both TX and RX
- Or use traditional bind button method

### 01.03.00 - EdgeTX Model Configuration

#### 01.03.01 - Create Three Flight Configurations

**Indoor Mode**:
```powershell
.\New-TX15Model.ps1 `
    -ModelType Quad `
    -AircraftName "Angel30" `
    -Receiver DarwinFPV `
    -Config Indoor
```

**Characteristics**:
- RC Rate: 50% on Roll/Pitch
- Throttle curve: Soft (exponential)
- Motor output limit: 70% (via Betaflight)
- Flight mode: Angle (self-leveling)

**Outdoor Mode**:
```powershell
.\New-TX15Model.ps1 `
    -ModelType Quad `
    -AircraftName "Angel30" `
    -Receiver DarwinFPV `
    -Config Outdoor
```

**Characteristics**:
- RC Rate: 70% on Roll/Pitch
- Throttle curve: Linear
- Motor output limit: 85%
- Flight mode: Horizon (angle + acro mix)

**Normal Mode**:
```powershell
.\New-TX15Model.ps1 `
    -ModelType Quad `
    -AircraftName "Angel30" `
    -Receiver DarwinFPV `
    -Config Normal
```

**Characteristics**:
- RC Rate: 100% (passthrough to Betaflight)
- Full throttle range
- Flight mode: Acro (rate mode)

#### 01.03.02 - 2-Step Arming Implementation

**Logical Switch L01 (Safe Arm)**:
```yaml
func: AND
v1: SA↑      # Arm switch up
v2: Thr<=-95%  # Throttle at minimum
delay: 0.5s
```

**Mix CH5 (Arm Channel)**:
```yaml
- source: MAX
  weight: -100  # Disarmed
  switch: '!L01'
  multiplex: REPLACE
- source: MAX
  weight: 100   # Armed
  switch: L01
  multiplex: REPLACE
```

**Throttle Cut (Special Function)**:
```yaml
switch: '!L01'
action: OverrideCH
param: CH3
value: -100
```

### 01.04.00 - Pre-Flight Checklist

- [ ] Battery voltage > 11.1V (3S) or > 14.8V (4S)
- [ ] Props removed for bench testing
- [ ] Arm switch down (disarmed)
- [ ] Throttle stick at minimum
- [ ] Range check completed
- [ ] Turtle mode tested (if enabled)
- [ ] Failsafe tested (turn off radio, verify disarm)

## 02.00.00 - Fixed Wing Setup (Fx707s with Reflex V3)

### 02.01.00 - Hardware Configuration

**Airframe**: Flying Bear Fx707s (foam conversion)
**Stabilizer**: Reflex V3 Flight Controller Gyro
**Receiver**: Cyclone PWM 7CH or HPXGRC
**Servos**: 9g x 4 (aileron, elevator, rudder, optional flaps)
**Motor**: 2212 1400KV or similar
**ESC**: 30A with BEC
**Battery**: 3S 2200mAh LiPo

### 02.02.00 - Reflex V3 Configuration

#### 02.02.01 - Firmware Update

1. Visit http://www.fmsmodel.com/page/reflex
2. Download latest Reflex V3 firmware
3. Connect via USB while holding bind button
4. Flash firmware using FMS tool

#### 02.02.02 - Wiring

**Receiver (Cyclone) to Reflex V3**:
```
Cyclone PWM1 (CH1) -> Reflex Aileron
Cyclone PWM2 (CH2) -> Reflex Elevator
Cyclone PWM3 (CH3) -> Reflex Throttle -> ESC
Cyclone PWM4 (CH4) -> Reflex Rudder
Cyclone PWM5 (CH5) -> Reflex Mode (3-pos)
Cyclone PWM6 (CH6) -> Reflex Arm/Gear
```

**Important**: CH5 is used for Reflex flight modes, NOT for arming.
Use CH6 for arming to avoid conflict.

#### 02.02.03 - Reflex Mode Mapping

Reflex V3 interprets CH5 as:
- **-100 to -33**: Beginner Mode (6-axis stabilization, bank limit 45°)
- **-33 to 33**: Advanced Mode (3-axis rate mode, bank limit 75°)
- **33 to 100**: Full Manual (gyro off, direct control)

### 02.03.00 - EdgeTX Model Configuration

#### 02.03.01 - Create Three Flight Configurations

**Beginner Mode**:
```powershell
.\New-TX15Model.ps1 `
    -ModelType FixedWing `
    -AircraftName "Fx707s" `
    -Receiver ReflexV3 `
    -Config Beginner
```

**Characteristics**:
- Control throws: 80% (limited via radio)
- Reflex mode: Beginner (6-axis)
- Expo: 25% on all axes
- Bank angle limit: 45° (enforced by Reflex)

**Advanced Mode**:
```powershell
.\New-TX15Model.ps1 `
    -ModelType FixedWing `
    -AircraftName "Fx707s" `
    -Receiver ReflexV3 `
    -Config Advanced
```

**Characteristics**:
- Control throws: 100%
- Reflex mode: Advanced (3-axis)
- Expo: 20%
- Bank angle limit: 75°

**Full Manual Mode**:
```powershell
.\New-TX15Model.ps1 `
    -ModelType FixedWing `
    -AircraftName "Fx707s" `
    -Receiver ReflexV3 `
    -Config Manual
```

**Characteristics**:
- Control throws: 100%
- Reflex mode: Off (pass-through)
- Expo: 15%
- No bank limits

#### 02.03.02 - 2-Step Arming (No CH5 Usage)

**Logical Switch L01 (Safe Arm)**:
```yaml
func: AND
v1: SD↑       # Arm switch up (NOT SA to avoid confusion)
v2: Thr<=-95% # Throttle at minimum
delay: 0.5s
```

**Mix CH6 (Arm Channel)**:
```yaml
- source: MAX
  weight: -100  # Cut
  switch: '!L01'
  multiplex: REPLACE
- source: MAX
  weight: 100   # Armed
  switch: L01
  multiplex: REPLACE
```

**Note**: CH5 is reserved for Reflex flight modes via SC switch.

#### 02.03.03 - Reflex Mode Indication

**Logical Switches for Audio Feedback**:
```yaml
L03:  # Beginner
  func: a<x
  v1: CH5
  v2: -33

L04:  # Advanced
  func: a<=x
  v1: CH5
  v2: 33
  and: '!L03'

L05:  # Manual
  func: a>x
  v1: CH5
  v2: 33
```

**Special Functions (Audio)**:
```yaml
SF03:
  switch: L03
  action: PlayTrack
  param: "beginner_mode"

SF04:
  switch: L04
  action: PlayTrack
  param: "advanced_mode"

SF05:
  switch: L05
  action: PlayTrack
  param: "manual_mode"
```

### 02.04.00 - Control Surface Setup

#### 02.04.01 - Servo Reversing

**Check directions**:
1. Aileron: Right stick right -> right aileron up
2. Elevator: Right stick back -> elevator up
3. Rudder: Left stick right -> nose right

**Reverse in Reflex V3 or radio as needed**.

#### 02.04.02 - Control Throws

**Beginner**:
- Aileron: ±10mm
- Elevator: ±8mm
- Rudder: ±15mm

**Advanced/Manual**:
- Aileron: ±15mm
- Elevator: ±12mm
- Rudder: ±20mm

### 02.05.00 - Pre-Flight Checklist

- [ ] CG at 25-30% of wing chord
- [ ] Control surfaces centered
- [ ] Reflex V3 LED: Solid = ready, Flashing = initializing
- [ ] Test all three Reflex modes on ground
- [ ] Verify correct control surface movement
- [ ] Range check
- [ ] Motor cut test (arm/disarm)

## 03.00.00 - Mode2 to Mode4 Switch Setup

### 03.01.00 - Implementation for All Models

**Global Variable**:
```yaml
GV1:
  name: "StickMode"
  default: 0
  min: 0
  max: 1
  popup: true
```

**Special Functions**:
```yaml
SF_Mode2:
  switch: SH↑
  action: AdjustGV
  param: GV1
  value: 0

SF_Mode4:
  switch: SH↓
  action: AdjustGV
  param: GV1
  value: 1
```

**Modified Mixes**:
```yaml
CH1 (Roll/Aileron):
  - source: Ail
    weight: 100
    switch: GV1=0
    multiplex: REPLACE
  - source: Rud
    weight: 100
    switch: GV1=1
    multiplex: REPLACE

CH4 (Yaw/Rudder):
  - source: Rud
    weight: 100
    switch: GV1=0
    multiplex: REPLACE
  - source: Ail
    weight: 100
    switch: GV1=1
    multiplex: REPLACE
```

### 03.02.00 - Verification

**Test Procedure**:
1. Set GV1 = 0 (Mode2)
2. Move left stick horizontally -> CH1 should change
3. Move right stick horizontally -> CH4 should change
4. Set GV1 = 1 (Mode4)
5. Move left stick horizontally -> CH4 should change
6. Move right stick horizontally -> CH1 should change

**Reference**: https://www.youtube.com/watch?v=kiKQy736huM

## 04.00.00 - Troubleshooting

### 04.01.00 - Common Issues

**Issue: Motors won't arm (Quad)**
- Check throttle is at minimum
- Verify arm switch position
- Check Betaflight modes tab for arm channel assignment
- Verify no pre-arm errors in OSD

**Issue: No servo movement (Fixed Wing)**
- Check receiver binding
- Verify PWM outputs in receiver config
- Check Reflex V3 initialization (LED status)
- Test with servo directly on receiver (bypass Reflex)

**Issue: Reflex V3 not changing modes**
- Verify CH5 connected to Reflex mode input
- Check switch output range (-100 to +100)
- Confirm 3-position switch assignment

**Issue: Mode2/Mode4 not switching**
- Check GV1 range (0-1)
- Verify SH switch assignment
- Test in EdgeTX Companion simulator

### 04.02.00 - Emergency Procedures

**Loss of control**:
1. Release sticks (failsafe should engage)
2. Turn off transmitter (failsafe)
3. If equipped, use "Return to Home" if available

**Flyaway**:
1. Switch to ANGLE mode (if available)
2. Reduce throttle
3. Use rudder to induce spin (lose altitude)
4. Cut throttle before impact

**Reflex V3 malfunction**:
1. Switch to Full Manual mode immediately
2. Fly manually without stabilization
3. Land as soon as safe
